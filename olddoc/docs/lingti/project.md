# Project: Lingti-Bot 实现 OpenClaw 全部能力

> 目标：用 lingti-bot 项目实现 OpenClaw 的所有能力，同时保持 lingti 单一文件、高效精简的原则。

---

## 📋 执行摘要

| 项目 | OpenClaw | Lingti-Bot |
|------|----------|------------|
| 开发语言 | TypeScript | Go |
| 架构复杂度 | 复杂（多进程、插件系统）| 精简（单一二进制、MCP 架构）|
| 单一二进制 | ❌ | ✅ |
| 核心优势 | 功能全面 | 部署简单、性能优异 |

**我们的策略**：
- 保留 lingti 的单一二进制、Go 语言、MCP 架构核心优势
- 逐步补充 OpenClaw 的高级功能
- 坚持"复杂已死，极简至上"的设计哲学

---

## ✅ 已完成功能

### 1. 核心基础能力

| 功能 | 状态 | 说明 |
|------|------|------|
| 多 AI 提供商支持 | ✅ | Claude、DeepSeek、Kimi、Qwen、OpenAI 兼容等 |
| 对话记忆系统 | ✅ | SQLite 持久化存储，跨会话记忆 |
| 工具调用系统 | ✅ | 丰富的本地工具集 |
| 多平台消息接入 | ✅ | Slack、Discord、Telegram、飞书、钉钉、企业微信 |
| 云中继模式 | ✅ | 免公网服务器，秒级接入 |
| 浏览器自动化 | ✅ | 纯 Go 实现，基于 go-rod |
| 语音功能 | ✅ | STT、TTS、语音唤醒 |

### 2. 近期完成的修复与改进

| 功能 | 状态 | 说明 |
|------|------|------|
| Markdown 文件上传 | ✅ | 支持将 markdown 文件内容提取为文本 |
| 多格式文件支持 | ✅ | 支持 50+ 种文本类型文件 |
| 文件大小限制 | ✅ | 500KB 限制，超限时自动截断并提示 |
| 历史消息 Attachments 清理 | ✅ | 确保历史消息不会导致 API 错误 |
| Qwen API 兼容性修复 | ✅ | 正确处理 MultiContent 格式 |

---

## 🚀 已完成与待开发功能（按优先级排序）

### Phase 1: 核心自动化能力（高优先级）

#### 1.1 定时任务系统 (Cron) ✅ 已完成
- **目标**：支持按计划执行任务
- **OpenClaw 参考**：`src/cron/`
- **Lingti 当前状态**：✅ 完整
- **实现**：
  - ✅ 扩展现有 `internal/cron/` 包
  - ✅ 支持通过对话创建定时任务
  - ✅ 任务持久化到 SQLite
  - ✅ 支持查看、删除、暂停/恢复任务
  - ✅ 添加标签支持：`user-schedule`（用户日程）和 `assistant-task`（助理任务）
- **验收标准**：
  - ✅ 用户可以说"每天早上 9 点提醒我开会"
  - ✅ 任务在重启后仍然保留
  - ✅ 支持查看、删除、暂停/恢复任务
  - ✅ 可以通过标签筛选任务

#### 1.2 持久化记忆系统 (RAG) ✅ 已完成
- **目标**：跨会话的知识库，重要信息永久保存
- **OpenClaw 参考**：`MEMORY.md`、`src/memory/`
- **实现**：
  - ✅ chromem-go 向量数据库集成
  - ✅ Qwen Embedding v3 嵌入模型
  - ✅ 对话结束时自动保存到 RAG
  - ✅ 对话开始时自动检索相关记忆
  - ✅ 自动提取用户偏好并保存
  - ✅ 配置持久化，支持 onboard 配置
- **验收标准**：
  - ✅ 用户说"我叫张三"，下次对话 AI 记得
  - ✅ 重要决策、事实自动保存
  - ✅ 支持语义搜索相关记忆

#### 1.3 模型自动切换 (Failover)
- **目标**：主模型失败时自动切换到备用模型
- **OpenClaw 参考**：多模型配置与降级策略
- **实现思路**：
  - 配置支持多个模型（主 + 备用列表）
  - API 调用失败时自动重试下一个模型
  - 记录模型切换日志
- **验收标准**：
  - 主模型超时时自动切换备用
  - 用户无感（除非所有模型都失败）

### Phase 2: 可视化与交互（中优先级）

#### 2.1 WebChat UI
- **目标**：浏览器端的聊天界面
- **OpenClaw 参考**：`ui/` 目录
- **实现思路**：
  - 轻量级前端（React/Vue/Svelte，选择最简单的）
  - 通过 WebSocket 与 lingti 后端通信
  - 保持单一二进制（前端嵌入 Go）
- **验收标准**：
  - 访问 `http://localhost:8080` 可以聊天
  - 支持文件上传、图片显示
  - 响应式设计，移动端可用

#### 2.2 macOS 菜单栏应用
- **目标**：原生 SwiftUI 菜单栏应用
- **OpenClaw 参考**：`apps/macos/`
- **实现思路**：
  - 简单的菜单栏图标 + 弹窗
  - 通过本地端口与 lingti 通信
  - 可选：语音快捷方式
- **验收标准**：
  - 点击菜单栏图标弹出聊天窗口
  - 支持快捷键唤起
  - 不影响 lingti 核心功能

### Phase 3: 更多平台与工具（中优先级）

#### 3.1 更多消息平台
- **目标**：支持 WhatsApp、iMessage、Signal、Microsoft Teams、Matrix 等
- **优先级排序**：
  1. Microsoft Teams（企业用户需求大）
  2. WhatsApp（国际用户）
  3. 其他根据需求
- **实现思路**：复用现有 `internal/platforms/` 架构

#### 3.2 更多效率工具集成
- **目标**：Notion、Obsidian、Trello 等
- **优先级排序**：
  1. Obsidian（已有 bundled-skills 框架）
  2. Notion
  3. 其他
- **实现思路**：利用现有的 Skills 系统

### Phase 4: 高级特性（低优先级）

#### 4.1 Extended Thinking
- **目标**：支持深度思考模式（Claude）
- **实现思路**：扩展现有 thinking level 配置

#### 4.2 Agent 间通信
- **目标**：多 Agent 协作（主 Agent 分解任务给子 Agent）
- **OpenClaw 参考**：`src/agents/tools/sessions-spawn-tool.ts`
- **实现思路**：在当前架构上轻量级实现，不引入复杂的多进程

#### 4.3 技能注册中心
- **目标**：类似 ClawHub 的技能市场
- **实现思路**：简单的 GitHub 仓库索引，用户可以一键安装

---

## 🎯 设计原则（必须遵守）

### 1. 单一二进制原则
- ❌ **禁止**：引入 Node.js、Python 等外部依赖
- ✅ **要求**：所有功能在 Go 生态内实现，编译为单一可执行文件

### 2. 高效精简原则
- ❌ **禁止**：过度设计、过度抽象
- ✅ **要求**：每个功能只做最必要的实现，代码简洁易懂

### 3. 渐进式增强原则
- ❌ **禁止**：一次性大改架构
- ✅ **要求**：在现有架构上逐步添加功能，保持兼容性

### 4. 中国用户优先原则
- ✅ **优先**：飞书、钉钉、企业微信、中文语音
- ✅ **优先**：国内云服务（阿里云、火山引擎等）

---

## 📊 开发进度跟踪

### 当前里程碑
- [x] **v0.1**: 核心基础功能
- [x] **v0.2**: 文件处理修复与增强
- [x] **v0.3**: 定时任务系统（支持标签）
- [x] **v0.4**: 持久化记忆（RAG + 用户偏好学习）
- [ ] **v0.5**: WebChat UI
- [ ] **v1.0**: 功能完整版本

---

## 🛠️ 技术架构

### 当前架构（保持不变）

```
lingti-bot (单一 Go 二进制)
├── internal/
│   ├── agent/          # AI 提供商、对话逻辑
│   ├── platforms/      # 消息平台接入
│   ├── tools/          # 本地工具集
│   ├── skills/         # 技能系统
│   ├── cron/           # 定时任务（扩展中）
│   ├── persist/        # 持久化（SQLite）
│   └── mcp/            # MCP 服务
└── cmd/                # CLI 命令
```

### 与 OpenClaw 架构对比

| 组件 | OpenClaw | Lingti-Bot | 我们的选择 |
|------|----------|------------|-----------|
| 插件系统 | ✅ 完整 | ❌ 无 | ❌ 不需要，用 Skills/MCP |
| Hooks 系统 | ✅ 完整 | ❌ 无 | ❌ 不需要，保持简单 |
| 多进程 | ✅ 是 | ❌ 否 | ❌ 保持单进程 |
| 前端应用 | ✅ 多个 | ❌ 无 | ⚠️ 可选，轻量级实现 |

---

## 📝 相关文档

- [OpenClaw 功能对比](docs/openclaw-feature-comparison.md)
- [开发路线图](docs/roadmap.md)
- [OpenClaw 参考](docs/openclaw-reference.md)

---

## 🤝 贡献指南

1. **先看设计原则**：确保你的方案符合"极简"理念
2. **小步快跑**：每个 PR 只做一件事
3. **保持兼容**：不要破坏现有功能
4. **中文优先**：文档、注释优先使用中文

---

*最后更新：2026-02-21*
